Revision: 53d6bf1039d118975dad47c2b6de15a9fa453067
Patch-set: 1
File: runtime/base/dumpable.h

74
Wed Oct 05 18:35:10 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f3c88c0_b193e05b
Bytes: 25
Can you add asserts here?

74
Wed Oct 05 20:02:08 2016 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_b193e05b
UUID: 7f3c88c0_d4f09256
Bytes: 4
Done

File: runtime/indirect_reference_table-inl.h

124
Wed Oct 05 18:35:10 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f3c88c0_b4a50ea0
Bytes: 48
Very hard to review due to moving to a new file.

124
Wed Oct 05 20:02:08 2016 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_b4a50ea0
UUID: 7f3c88c0_f47ef6b2
Bytes: 24
Unnecessary move, fixed.

File: runtime/jni_env_ext-inl.h

29:38-29:56
Wed Oct 05 18:35:10 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f3c88c0_f4ddd603
Bytes: 74
minor: why does it matter? we should have a up_cast operation for ObjPtr .

29:38-29:56
Wed Oct 05 18:48:07 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_f4ddd603
UUID: 7f3c88c0_34959eec
Bytes: 310
Do I understand it correctly that you're asking for an implicit conversion to happen? Otherwise it would be inconvenient to have to write this explicitly everywhere.

However, there should be consistency. Why do this for this one case (obviously for convenience), but leave a lot of other places non-templated?

29:38-29:56
Wed Oct 05 20:02:08 2016 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_34959eec
UUID: 7f3c88c0_d454121f
Bytes: 144
A lot of places only use mirror::Object and don't need casts. I can delete this since there is already an implicit templated ObjPtr constructor.

29:38-29:56
Wed Oct 05 20:44:29 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_d454121f
UUID: 7f3c88c0_9a2fd1f6
Bytes: 399
Yes, I see the implicit constructor, so we don't need this particular line changed then?

However you should fix ObjPtr::ObjPtr to do a compile-time type check with std::is_base_of, right now it lets you do implicit downcasts which is unsafe.

Downcasting should be the same as the existing mirror downcasting, it should do a runtime check (either regular CHECK or DCHECK) and it should be explicit.

29:38-29:56
Wed Oct 05 20:45:20 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f3c88c0_9a2fd1f6
UUID: 7f3c88c0_9a611133
Bytes: 20
Separate CL, though.

