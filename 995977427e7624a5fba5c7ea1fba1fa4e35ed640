Revision: 995977427e7624a5fba5c7ea1fba1fa4e35ed640
Patch-set: 3
File: runtime/indirect_reference_table.cc

131:25-131:33
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_d7d97342
Bytes: 5
const

131:14-131:24
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a18a68d9_017fca1c
Bytes: 21
nit: CountNullEntries

131:25-131:33
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_d7d97342
UUID: 41828cce_f6a70091
Bytes: 46
Requires additional const GetReference(). Done

131:14-131:24
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a18a68d9_017fca1c
UUID: 217f589a_f57e181f
Bytes: 4
Done

142:0-143:68
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a18a68d9_8173da5b
Bytes: 38
Very elegant and intuitive, thank you!

154
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a18a68d9_e1d8a609
Bytes: 239
I suppose it'll constantly go into this branch whenever we pop a 0-entry frame?

But it won't matter because the scanning times will instantly finish (since there's only 0 entries).

Probably should add a comment about this somewhere here.

154
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a18a68d9_e1d8a609
UUID: 610a305f_afb339f0
Bytes: 61
I tried to hint at that with the "O(1) overhead" in line 129.

File: runtime/indirect_reference_table.h

49
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_5761e3ec
Bytes: 27
Is this accurate for weaks?

49
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_5761e3ec
UUID: 6190700a_1f62c355
Bytes: 4
Done

58
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_5788c36e
Bytes: 168
This implies can't call DeleteLocalRef for something created prior to a PushFrame.

I think we should call out the semantics here as well as the efficiency requirements

58
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_5788c36e
UUID: 8164840b_780f61a2
Bytes: 76
This sentence is the semantics requirement. I don't know what you want here.

87:13-87:21
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_97d9bb85
Bytes: 1
?

87:13-87:21
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_97d9bb85
UUID: 6190700a_9fc333f1
Bytes: 4
Done

88:17-90:55
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_d7a173e3
Bytes: 64
Why does this matter?

It says it's not a real pointer on L50-51

88:17-90:55
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_d7a173e3
UUID: c1d3dce9_72c1d81c
Bytes: 4
Done

92:70-92:71
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_97b09b2b
Bytes: 87
: here will probably be more clear the rest of the sentences elaborate on this sentence

92:70-92:71
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_97b09b2b
UUID: c1d3dce9_d2af6461
Bytes: 4
Done

94:38-95:18
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_77ad07cf
Bytes: 23
Is this 2x still right?

94:38-95:18
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_77ad07cf
UUID: c1d3dce9_95dc66cb
Bytes: 24
Weakened to "more." Done

104
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_37fa6fcd
Bytes: 131
(Unrelated to your code)

I don't like this, it overloads handlescope and invalid? Why don't we have -1 or 4, etc for handle scope?

104
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_37fa6fcd
UUID: c1d3dce9_35833a9e
Bytes: 131
So you want to make JNI transitions slower? How do you encode -1 into an IndirectRef (jobject)? Same for 4. That needs more bits...

108:11-108:13
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_7704e7ee
Bytes: 21
nit align = by column

108:11-108:13
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_7704e7ee
UUID: c1d3dce9_d5674e42
Bytes: 4
Done

115:74-115:78
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_b7f4bfdb
Bytes: 110
not new code but if its not too much trouble, make this into a kKindMask or similar? 

   (1 << kKindBits) - 1

115:74-115:78
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_b7f4bfdb
UUID: 610a305f_0fab652a
Bytes: 4
Done

142:67-142:71
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_f76597cb
Bytes: 23
bits for the top index.

142:67-142:71
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_f76597cb
UUID: 610a305f_af05f9c0
Bytes: 4
Done

143:23-143:27
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_576ba39f
Bytes: 6
within

143:23-143:27
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_576ba39f
UUID: 610a305f_8f02b5b4
Bytes: 4
Done

175
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_b782ff1f
Bytes: 62
add a static_assert for this please. IsPowerOfTwo in bit_utils

175
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_b782ff1f
UUID: 610a305f_ef0f01db
Bytes: 4
Done

342
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_b7295f54
Bytes: 163
nit: use uref >> (kKindBits + kSerialBits) or (uref >> kKindBits) >> kSerialBits to avoid having to think about whether >> is left associative or right associative

342
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_b7295f54
UUID: 610a305f_0fe085e4
Bytes: 4
Done

349:47-349:49
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_172f6b56
Bytes: 14
nit: magic 32s

349:47-349:49
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_172f6b56
UUID: 610a305f_afee99d4
Bytes: 4
Done

384:30-384:36
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_378d4fbe
Bytes: 6
modulo

384:30-384:36
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_378d4fbe
UUID: 610a305f_2fc0e939
Bytes: 4
Done

393:17-393:22
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc0a8fd0_17964bd6
Bytes: 16
table's capacity

393:17-393:22
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc0a8fd0_17964bd6
UUID: 610a305f_6fcaf159
Bytes: 4
Done

File: runtime/jni_internal_test.cc

2321
Mon Oct 24 18:17:11 2016 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a18a68d9_c1248226
Bytes: 50
nit: can probably just add == and != to the state.

2321
Tue Oct 25 00:45:36 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a18a68d9_c1248226
UUID: 610a305f_efbd41bb
Bytes: 80
Yeah, I just wanted to avoid the complication for these few instances for now...

