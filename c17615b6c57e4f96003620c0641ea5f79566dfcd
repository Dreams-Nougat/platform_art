Revision: c17615b6c57e4f96003620c0641ea5f79566dfcd
Patch-set: 1
File: dex2oat/dex2oat.cc

935:9-936:58
Sat Jan 30 00:32:05 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: f465d6c4_6fb8b18d
Bytes: 112
Not really sure that should be the condition. If you want it this way, I'd really want a warning otherwise here.

935:9-936:58
Mon Feb 01 11:35:12 2016 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f465d6c4_6fb8b18d
UUID: 517cf4a3_b5eae093
Bytes: 313
Also, I would introduce a 

  bool PreservesDeterministicCompiling() {
    return (gc::kCollectorTypeDefault == gc::kCollectorTypeCMS ||
            gc::kCollectorTypeDefault == gc::kCollectorTypeMS) &&
        !kEmitCompilerReadBarrier;
  }

predicate and use it here and also as a condition on line 1185â€“1187.

935:9-936:58
Mon Feb 01 19:58:31 2016 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 517cf4a3_b5eae093
UUID: 5422228b_9fc9ab37
Bytes: 421
How about this:

if (!kIsTargetBuild && IsBootImage()) {
  if (SupportsDeterministicCompilation()) {
    force_determinism_ = true;
  } else {
    LOG(WARNING) << "Deterministic compilation is disabled."
  }
}

bool SupportsDeterministicCompilation() {
    return (gc::kCollectorTypeDefault == gc::kCollectorTypeCMS ||
            gc::kCollectorTypeDefault == gc::kCollectorTypeMS) &&
        !kEmitCompilerReadBarrier;
}

1185:12-1185:36
Mon Feb 01 19:58:31 2016 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 548b02a3_1c304c8e
Bytes: 136
if (SupportsDeterministicCompilation()) {
  Usage("Cannot use --force-determinism with read barriers or a non-CMS garbage collector");
}

