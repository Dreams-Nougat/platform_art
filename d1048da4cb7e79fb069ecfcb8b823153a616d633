Revision: d1048da4cb7e79fb069ecfcb8b823153a616d633
Patch-set: 15
File: /COMMIT_MSG

7
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_16de7acd
Bytes: 41
and x84_64 (first line is displayed most)

7
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_16de7acd
UUID: cb1db24e_2b022be2
Bytes: 4
Done

13
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_d6e3029b
Bytes: 40
I don't think this build line is needed.

13
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_d6e3029b
UUID: cb1db24e_4be7673c
Bytes: 4
Done

14:22-14:26
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_f6939e03
Bytes: 129
did you also run the tests with both mirror::kUseStringCompression = false (default now) and true? If so, please add to this line

14:22-14:26
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_f6939e03
UUID: cb1db24e_6be42337
Bytes: 4
Done

File: compiler/optimizing/code_generator_x86.cc

5077:18-5077:39
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_f95d514a
Bytes: 187
I like what you did below putting this in a boolean with a more intuitive name (even though you need the value here only once, it documents itself through the name then and is consistent)

5077:18-5077:39
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_f95d514a
UUID: cb1db24e_ab529b01
Bytes: 4
Done

5082
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b0462f6a_431506a9
Bytes: 15
Same as x86-64.

5082:49-5082:52
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_796a41e6
Bytes: 151
both following true/else contain cmpl, so you can move that up; also, you could compare directly with 0 immediate saving the movl and even the register

5082
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b0462f6a_431506a9
UUID: cb1db24e_8b6cffc7
Bytes: 4
Done

5082:49-5082:52
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_796a41e6
UUID: cb1db24e_ab69bbb7
Bytes: 4
Done

5085
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_b974b9c3
Bytes: 137
omit the _1 and _2, they are local variables just in scope of the true/else; your name implies there are two labels in the generated code

5085
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_b974b9c3
UUID: cb1db24e_cba0b702
Bytes: 4
Done

5094
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_f909d138
Bytes: 174
it feels you could move most of the true/false branch into one block of code, only making a difference in the movzxb and movzwx instructions; that way less code is duplicated

5094
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_f909d138
UUID: cb1db24e_2bb06b4a
Bytes: 4
Done

5105
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_393a89ed
Bytes: 98
I would not use capitals for String Compression everywhere, unless this is a true name we gave it?

5105
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_393a89ed
UUID: cb1db24e_cb2b578c
Bytes: 4
Done

5596:0-5599:7
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: d049e37c_04e4b6a0
Bytes: 12
Unnecessary.

5596:0-5599:7
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d049e37c_04e4b6a0
UUID: cb1db24e_eb3013f7
Bytes: 4
Done

File: compiler/optimizing/code_generator_x86_64.cc

35:17-35:18
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_f9de315d
Bytes: 30
was this for debugging? remove

35:17-35:18
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_f9de315d
UUID: cb1db24e_4596764b
Bytes: 4
Done

4581
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_dc4963ba
Bytes: 44
from here on, same comments as I gave in x86

4581
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_dc4963ba
UUID: cb1db24e_6b6fc3bc
Bytes: 4
Done

4586
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_a72dea03
Bytes: 220
You need

  codegen_->MaybeRecordImplicitNullCheck(instruction);

here instead of later after the switch.

And why not directly

  __ cmpl(Address(obj, count_offset), Immediate(0))

? That way we can avoid the temporary.

4586
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_a72dea03
UUID: cb1db24e_d0cf827b
Bytes: 4
Done

5040
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_87d666b7
Bytes: 86
Maybe this optimization isn't so useful for string compression and should be disabled.

5040
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_87d666b7
UUID: cb1db24e_d02b028c
Bytes: 48
which part should be disabled? The whole charAt?

5068:0-5071:7
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 708af7dc_41f87262
Bytes: 56
Unnecessary. This has already been done for ArrayLength.

5068:0-5071:7
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 708af7dc_41f87262
UUID: cb1db24e_908d0ae1
Bytes: 4
Done

File: compiler/optimizing/intrinsics_x86.cc

1404:10-1404:16
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: d049e37c_64580a5a
Bytes: 19
and compression tag

1404:10-1404:16
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d049e37c_64580a5a
UUID: cb1db24e_eb781358
Bytes: 4
Done

1406:14-1406:21
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_67137270
Bytes: 20
and compression tags

1406:14-1406:21
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_67137270
UUID: cb1db24e_5cd1f3c0
Bytes: 163
is it ever possible that two identical strings are compressed and not compressed at the same time (I hope not :-). In any case, it is good to comment on that here.

1406:14-1406:21
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_67137270
UUID: cb1db24e_2b730b79
Bytes: 4
Done

1406:14-1406:21
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_5cd1f3c0
UUID: cb1db24e_6b85033e
Bytes: 4
Done

1410
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_47186e88
Bytes: 42
Zero-length string is uncompressed, right?

1410
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_47186e88
UUID: cb1db24e_0b29ef4a
Bytes: 155
Zero-length string is compressed for the case of allocation new string from strings: A (empty) + B (ascii - compressed) => new_string (ascii - compressed).

1418:2-1418:31
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_270d7a4a
Bytes: 90
Check if strings are compressed (either both are or neither is thanks to the check above).

1418:21-1418:31
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_fcc1bff7
Bytes: 13
period at end

1418:21-1418:31
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_fcc1bff7
UUID: cb1db24e_2b45cbf8
Bytes: 4
Done

1418:2-1418:31
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_270d7a4a
UUID: cb1db24e_4baf679d
Bytes: 4
Done

1429:0-1430:29
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_07127668
Bytes: 43
This can be merged to addl (0x8000000 + 3).

1429:0-1430:29
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_07127668
UUID: cb1db24e_0bc56f51
Bytes: 145
I tried for an example if ECX is 1, ((1 AND INT32_MAX) + 3) is 4, meanwhile (1 + 134217728 + 3) is 134217732. Is this aligned with what you mean?

1434:59-1434:60
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_c7033e1b
Bytes: 17
or 4 (compressed)

1434:59-1434:60
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_c7033e1b
UUID: cb1db24e_8b34ff94
Bytes: 4
Done

1536
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_9cdb6be1
Bytes: 13
period at end

1536
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_9cdb6be1
UUID: cb1db24e_6bac23a8
Bytes: 4
Done

1537
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_871e6666
Bytes: 230
It would be cleaner if we instead checked the flag right here and split the code below into two separate paths.

Note that the zero-length check can be done before this, assuming that zero-length string is considered uncompressed.

1537
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_871e6666
UUID: cb1db24e_ddd87ae6
Bytes: 162
zero-length is compressed so it has to be after clean up the top-most bit. As for the split, I feel there will be many code duplication if it is split this early?

1545:18-1545:29
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_67049221
Bytes: 11
comparison?

1545:18-1545:29
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_67049221
UUID: cb1db24e_8bb95fe7
Bytes: 4
Done

1551:12-1551:22
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_07139665
Bytes: 143
Input string_obj is clobbered! Do we have a pre-existing bug here? (Or, how are we telling the register allocator that the input is clobbered?)

1551:12-1551:22
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_07139665
UUID: cb1db24e_3dc7ce0b
Bytes: 230
It is on purpose I guess by looking at the CreateStringIndexOfLocations with comment "As we clobber EDI during execution anyways, also use it as the output". I have no further information though how this will affected the process.

1587
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_1cde9bcd
Bytes: 6
period

1587
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_1cde9bcd
UUID: cb1db24e_abb61bf1
Bytes: 4
Done

1749
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_3ce3579b
Bytes: 6
period

1749
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_3ce3579b
UUID: cb1db24e_cba197ad
Bytes: 4
Done

1750:2-1750:43
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b0462f6a_034a6ea9
Bytes: 73
Don't load the tag into a register, do the comparison against the memory.

1750:2-1750:43
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b0462f6a_034a6ea9
UUID: cb1db24e_bd2f3efa
Bytes: 4
Done

1758:41-1758:45
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_672db29f
Bytes: 4
typo

1758:41-1758:45
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_672db29f
UUID: cb1db24e_6b93435a
Bytes: 4
Done

1765:12-1765:16
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 305b1f41_c73d7eca
Bytes: 4
copy

1765:12-1765:16
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 305b1f41_c73d7eca
UUID: cb1db24e_ab8d3b37
Bytes: 4
Done

1768
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_5cf81343
Bytes: 6
period

1768
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_5cf81343
UUID: cb1db24e_3d7fce06
Bytes: 4
Done

1805:12-1805:16
Fri Sep 16 14:21:08 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 30907f09_dfaa1b24
Bytes: 4
copy

1805:12-1805:16
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 30907f09_dfaa1b24
UUID: cb1db24e_9cf28b5f
Bytes: 10
and period

1805:12-1805:16
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_9cf28b5f
UUID: cb1db24e_9d860212
Bytes: 4
Done

1805:12-1805:16
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 30907f09_dfaa1b24
UUID: cb1db24e_7d894624
Bytes: 4
Done

1810
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_dc8ec3e0
Bytes: 4
same

1810
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_dc8ec3e0
UUID: cb1db24e_bd93be4f
Bytes: 4
Done

File: compiler/optimizing/intrinsics_x86_64.cc

1643
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_fc937f03
Bytes: 29
here and below, period at end

1643
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_fc937f03
UUID: cb1db24e_cb4c3743
Bytes: 4
Done

File: runtime/arch/x86/quick_entrypoints_x86.S

1978
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_3cb51783
Bytes: 7
no tabs

1978
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_3cb51783
UUID: cb1db24e_abc53b86
Bytes: 4
Done

File: runtime/arch/x86_64/quick_entrypoints_x86_64.S

2102
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_5caad326
Bytes: 7
no tabs

2102
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_5caad326
UUID: cb1db24e_4bce87ae
Bytes: 4
Done

File: test/609-checker-x86-bounds-check/src/Main.java

82
Fri Sep 16 20:27:37 2016 +0000
Author: Aart Bik <1074526@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cb1db24e_bca10747
Bytes: 83
wait, isn't this conditional on setting the feature on? you presubmit passed though

82
Mon Sep 19 21:17:13 2016 +0000
Author: Jessica Handojo <1113370@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: cb1db24e_bca10747
UUID: cb1db24e_0bd48f3a
Bytes: 70
Sorry, I messed up with changes from other local branches and settings

