Revision: f00c2d04f1d2ae8239cf5746f241812a331c7989
Patch-set: 4
File: compiler/Android.bp

177:0-178:1
Tue Sep 20 01:05:29 2016 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: f0ac2770_6efec353
Bytes: 101
does anyone seriously object to adding this in as a dependency? I'd rather not add unnecessary ifdef.

177:0-178:1
Tue Sep 20 05:24:09 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_6efec353
UUID: f0ac2770_d9cea3ac
Bytes: 108
Just to make sure: libcrypto routines are supported on borg? We won't run into issues doing this in general?

177:0-178:1
Tue Sep 20 05:32:42 2016 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_d9cea3ac
UUID: f0ac2770_5975d35d
Bytes: 43
like all things borg, we'd statically link.

177:0-178:1
Tue Sep 20 20:05:11 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_5975d35d
UUID: 30907f09_e217484e
Bytes: 265
I've asked the same question on the internal change, and Alexey did say:

"The goal is to avoid libcrypto dependency and the build ID generation on the device where it's not needed."

Which makes sense if libcrypto is not loaded on device, but I guess it always is?

177:0-178:1
Tue Sep 20 21:05:25 2016 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 30907f09_e217484e
UUID: f0ac2770_02411b3c
Bytes: 330
i guess your point is that linking against it dynamically affects dex2oat startup time, though it should be pretty small as the file will be mapped in for other processes, so there won't be an i/o cost, just dynamic linking for symbol used. and if that is the real concern, you could use dlopen/dlsym for the symbol lookup lazily.

177:0-178:1
Tue Sep 20 21:15:34 2016 +0000
Author: Alexey Alexandrov <1122300@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_02411b3c
UUID: f0ac2770_e28ddf35
Bytes: 166
Symbol binding is lazy on Linux by default so not likely the binding is going to be an issue.

I'm going to remove the define unless there are last minute objections.

177:0-178:1
Tue Sep 20 21:56:47 2016 +0000
Author: Alexey Alexandrov <1122300@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_e28ddf35
UUID: f0ac2770_f80cb09d
Bytes: 216
Looks like Android binaries have

0x0000001e (FLAGS)                      BIND_NOW

in the dynamic section though.  I'll time whether having libcrypto.so dependency changes "time dex2oat" output in a significant way.

File: compiler/elf_builder.h

78:40-78:42
Tue Sep 20 01:05:29 2016 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: f0ac2770_ce0c979e
Bytes: 100
is there an boringssl constant for this? yes...

SHA_DIGEST_LENGTH

obviously requires lack of ifdef

78:40-78:42
Tue Sep 20 16:34:26 2016 +0000
Author: Alexey Alexandrov <1122300@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f0ac2770_ce0c979e
UUID: f0ac2770_da553150
Bytes: 213
I can include the header and use the macro if we agree universally depending on boringssl is fine.  I personally hate #ifdef's and would be glad to kill it but I'm happy to do whatever the team thinks is the best.

474:6-474:25
Tue Sep 20 09:50:47 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 508b33e0_03b1104d
Bytes: 25
Use the initializer-list.

474:6-474:25
Tue Sep 20 16:34:26 2016 +0000
Author: Alexey Alexandrov <1122300@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 508b33e0_03b1104d
UUID: f0ac2770_ba039569
Bytes: 4
Done

